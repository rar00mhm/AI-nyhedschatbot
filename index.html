<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RKV 2025 – Hej‑style Chat (static)</title>
  <style>
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: #fff; color: #111; }

    /* Topbar */
    .topbar { background: #e30613; color: #fff; }
    .topbar-inner { max-width: 1100px; margin: 0 auto; height: 40px; display: flex; align-items: center; gap: 16px; padding: 0 16px; }
    .brand { font-weight: 800; }
    .nav { display: none; gap: 12px; }
    @media (min-width: 768px) { .nav { display: flex; } }
    .nav a { color: #fff; text-decoration: none; }
    .actions { margin-left: auto; display: flex; gap: 8px; }
    .actions button { height: 28px; border-radius: 999px; border: 0; padding: 0 10px; cursor: pointer; }
    .actions .plus { background: #ffeb3b; color: #000; }
    .actions .login { background: #fff; color: #000; }
    .actions .search { background: transparent; color: #fff; }

    /* Hero */
    .hero { max-width: 1100px; margin: 24px auto 0; padding: 0 16px; text-align: center; }
    .hero-logo { width: 48px; height: 48px; border-radius: 999px; background: #ffe066; display: grid; place-items: center; font-size: 26px; margin: 0 auto 8px; }
    .hero-title { font-weight: 800; font-size: 36px; }
    .hero-hey { font-weight: 900; }
    .hero-brand { font-size: 20px; font-weight: 700; margin-left: 6px; }
    .hero-sub { color: #475569; max-width: 700px; margin: 8px auto 0; }

    /* Suggestion tiles */
    .suggest-grid { margin-top: 16px; display: grid; grid-template-columns: 1fr; gap: 10px; }
    @media (min-width: 640px) { .suggest-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (min-width: 900px) { .suggest-grid { grid-template-columns: repeat(3, 1fr); } }
    .tile { text-align: left; border: 1px solid #e5e7eb; padding: 10px 12px; border-radius: 14px; background: #fff; box-shadow: 0 1px 2px rgba(0,0,0,.05); cursor: pointer; transition: .15s; }
    .tile:hover { box-shadow: 0 2px 6px rgba(0,0,0,.08); transform: translateY(-1px); }
    .tile-emoji { margin-right: 6px; }
    .tile-text { font-size: 14px; }

    /* Chat */
    .chat-wrap { max-width: 1100px; margin: 16px auto 0; padding: 0 16px 140px; }
    .msgs { display: flex; flex-direction: column; gap: 12px; min-height: 30vh; }
    .msg { display: flex; gap: 8px; }
    .msg.left { justify-content: flex-start; }
    .msg.right { justify-content: flex-end; }
    .avatar { width: 32px; height: 32px; border-radius: 999px; display: grid; place-items: center; }
    .avatar.bot { background: #ffec80; }
    .avatar.user { background: #e2e8f0; }
    .bubble { max-width: 80%; padding: 12px; border-radius: 14px; box-shadow: 0 1px 2px rgba(0,0,0,.06); }
    .bubble-bot { background: #f8fafc; border: 1px solid #e5e7eb; }
    .bubble-user { background: #0f172a; color: #fff; }
    .content { white-space: pre-wrap; }
    .sources { margin-top: 8px; padding-top: 6px; border-top: 1px solid #e2e8f0; }
    .sources-title { font-size: 10px; letter-spacing: .04em; color: #64748b; text-transform: uppercase; margin-bottom: 4px; }
    .src-title { font-weight: 600; font-size: 12px; }
    .src-snippet { color: #64748b; font-size: 12px; }
    .src-link { font-size: 12px; }
    .loading { text-align: center; color: #64748b; font-size: 14px; }

    /* Composer */
    .composer { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255,255,255,.9); backdrop-filter: blur(6px); border-top: 1px solid #e5e7eb; }
    .composer-inner { max-width: 780px; margin: 10px auto 0; display: flex; gap: 8px; border: 1px solid #e5e7eb; border-radius: 999px; background: #fff; padding: 6px; }
    .composer textarea { flex: 1; border: 0; outline: 0; resize: none; height: 44px; padding: 10px 12px; font-size: 14px; }
    .composer .send { width: 48px; height: 44px; border-radius: 999px; border: 0; background: #0f172a; color: #fff; font-size: 18px; cursor: pointer; }
    .login-hint { text-align: center; margin: 6px 0 12px; font-size: 12px; color: #64748b; }
    .login-hint a { color: inherit; text-decoration: none; }

    /* Tiny config badge */
    .config { position: fixed; right: 10px; bottom: 90px; background: #0f172a; color: #fff; font-size: 12px; padding: 6px 10px; border-radius: 999px; opacity: .85; }
    .config input { width: 280px; border: 0; border-radius: 8px; padding: 6px 8px; margin-left: 6px; }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">RKV</div>
      <nav class="nav">
        <a href="#">Start</a>
        <a href="#">Sport</a>
        <a href="#">Nyheder</a>
        <a href="#">Kultur</a>
        <a href="#">Ledere</a>
        <a href="#">Hej</a>
      </nav>
      <div class="actions">
        <button class="search">🔎 Søg</button>
        <button class="plus">Køb Plus</button>
        <button class="login">Log ind</button>
      </div>
    </div>
  </div>

  <section class="hero">
    <div class="hero-logo">🙂</div>
    <div class="hero-title"><span class="hero-hey">Hej</span> <span class="hero-brand">RKV 2025</span></div>
    <p class="hero-sub">Stil spørgsmål om RKV’s journalistik og få AI‑genererede svar. Svarene bygger på jeres egne kilder.</p>

    <div id="suggest" class="suggest-grid"></div>
  </section>

  <main class="chat-wrap">
    <div id="msgs" class="msgs"></div>
  </main>

  <div class="composer">
    <div class="composer-inner">
      <textarea id="input" placeholder="Skriv dit spørgsmål her"></textarea>
      <button id="send" class="send">➤</button>
    </div>
    <div class="login-hint"><a href="#login">Log ind for at stille egne spørgsmål</a></div>
  </div>

  <div class="config">
    API:
    <input id="apiUrl" placeholder="https://din-backend.dk/api/ask" />
  </div>

  <script>
    // ---------- Config ----------
    const DEFAULT_SUGGESTED = [
      { t: "Hvordan stemmer jeg til valget?", e: "🗳️" },
      { t: "Hvad er status på kommunens budget?", e: "🏛️" },
      { t: "Hvad betyder ændringerne i dagpengene?", e: "💬" },
      { t: "Hvem vandt i går?", e: "🏆" },
      { t: "Hvad er de nye regler for væsker i lufthavnen?", e: "✈️" },
      { t: "Hvad sker der med Northvolt?", e: "🧪" }
    ];

    // Hvis du har en backend-URL, så indsæt den her eller i feltet nederst til højre.
    // Eksempel: const API_URL = "https://din-backend.onrender.com/api/ask";
    let API_URL = null; // null = demo/mock svar

    // Restore fra localStorage hvis man har skrevet en URL før
    const saved = localStorage.getItem("rkv_api_url");
    if (saved) { API_URL = saved; }

    // ---------- UI helpers ----------
    const $ = s => document.querySelector(s);
    const msgsEl = $("#msgs");
    const inputEl = $("#input");
    const sendBtn = $("#send");
    const suggestEl = $("#suggest");
    const apiUrlEl = $("#apiUrl");

    apiUrlEl.value = API_URL || "";
    apiUrlEl.addEventListener("change", () => {
      API_URL = apiUrlEl.value.trim() || null;
      if (API_URL) localStorage.setItem("rkv_api_url", API_URL);
      else localStorage.removeItem("rkv_api_url");
    });

    function addMessage(role, content, sources) {
      const wrap = document.createElement("div");
      wrap.className = "msg " + (role === "user" ? "right" : "left");

      if (role !== "user") {
        const av = document.createElement("div");
        av.className = "avatar bot";
        av.textContent = "🤖";
        wrap.appendChild(av);
      }

      const bubble = document.createElement("div");
      bubble.className = "bubble " + (role === "user" ? "bubble-user" : "bubble-bot");

      const cont = document.createElement("div");
      cont.className = "content";
      cont.textContent = content;
      bubble.appendChild(cont);

      if (sources && sources.length) {
        const sct = document.createElement("div");
        sct.className = "sources";
        const title = document.createElement("div");
        title.className = "sources-title";
        title.textContent = "Kilder";
        sct.appendChild(title);
        const ul = document.createElement("ul");
        sources.forEach(s => {
          const li = document.createElement("li");
          li.innerHTML = `
            <div class="src-title">${s.title || "Ukendt kilde"}</div>
            ${s.snippet ? `<div class="src-snippet">${s.snippet}</div>` : ""}
            ${s.url ? `<a class="src-link" target="_blank" rel="noreferrer" href="${s.url}">${s.url}</a>` : ""}
          `;
          ul.appendChild(li);
        });
        sct.appendChild(ul);
        bubble.appendChild(sct);
      }

      wrap.appendChild(bubble);

      if (role === "user") {
        const av = document.createElement("div");
        av.className = "avatar user";
        av.textContent = "🧑";
        wrap.appendChild(av);
      }

      msgsEl.appendChild(wrap);
      window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
    }

    function sanitizeQuery(q) { return (q || "").replace(/\s+/g, " ").trim(); }

    async function ask(query) {
      query = sanitizeQuery(query);
      if (!query) return;
      addMessage("user", query);
      inputEl.value = "";

      try {
        if (!API_URL) {
          await new Promise(r => setTimeout(r, 500));
          addMessage("assistant", `(Demo-svar) Du spurgte: "${query}". Her ville vi normalt kalde din artikeldatabase + OpenAI.`, [
            { title: "Demo-kilde", url: "https://example.com", snippet: "Dette er en demo." }
          ]);
          return;
        }

        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ query, topK: 5, model: "gpt-4o" })
        });
        if (!res.ok) throw new Error("API fejl: " + res.status);
        const data = await res.json();
        addMessage("assistant", data.answer || "(Tomt svar)", data.sources || []);
      } catch (e) {
        addMessage("assistant", "Der skete en fejl: " + (e && e.message ? e.message : e));
      }
    }

    // suggestions
    DEFAULT_SUGGESTED.forEach((s) => {
      const b = document.createElement("button");
      b.className = "tile";
      b.innerHTML = `<span class="tile-emoji">${s.e}</span><span class="tile-text">${s.t}</span>`;
      b.addEventListener("click", () => ask(s.t));
      suggestEl.appendChild(b);
    });

    // input handlers
    sendBtn.addEventListener("click", () => ask(inputEl.value));
    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); ask(inputEl.value); }
    });
  </script>
</body>
</html>
